<view class="container" wx:if="{{activity}}">
  <view class="hero">
    <image class="banner" src="{{activity.image}}" mode="aspectFill" />
    <view class="hero-overlay"></view>
    <view class="hero-content">
      <view class="status-tag {{status==1?'ongoing':''}} {{status==2?'finished':''}}">
        {{status === 0 ? 'æŠ¥åä¸­' : (status === 1 ? 'è¿›è¡Œä¸­' : 'å·²ç»“æŸ')}}
      </view>
    </view>
  </view>

  <view class="content-body">
    <view class="header-card">
      <view class="title">{{activity.title}}</view>
      <view class="tags">
        <text class="tag" wx:for="{{activity.tags}}" wx:key="*this">{{item}}</text>
      </view>
    </view>

    <view class="info-section">
      <view class="info-row">
        <view class="icon-box">ğŸ“…</view>
        <view class="info-text">
          <view class="label">æ—¶é—´</view>
          <view class="val">{{activity.date}} {{activity.time}}</view>
        </view>
      </view>
      
      <view class="info-row">
        <view class="icon-box">ğŸ“</view>
        <view class="info-text">
          <view class="label">åœ°ç‚¹</view>
          <view class="val">{{activity.city}} Â· {{activity.venue}}</view>
          <view class="sub">è·ç¦»æ‚¨ {{activity.distance}}km</view>
        </view>
      </view>
    </view>

    <view class="info-row">
        <view class="icon-box">ğŸ‘¥</view>
        <view class="info-text">
            <view class="label">å‚ä¸äººæ•°</view>
            <view class="val">{{activity.current_people || 0}}/{{activity.max_people || 'ä¸é™'}}</view>
            <view class="sub" wx:if="{{isJoined && status > 0}}">
              å·²å‚ä¸
              <text wx:if="{{isCreator}}" class="creator-badge">ï¼ˆå‘èµ·è€…ï¼‰</text>
            </view>
        </view>
    </view>

    <view class="desc-section">
      <view class="section-title">æ´»åŠ¨è¯¦æƒ…</view>
      <view class="desc-text">{{activity.description || 'æš‚æ— æ´»åŠ¨è¯¦æƒ…'}}</view>
    </view>

    <!-- ç›¸å…³å›¾ç‰‡ -->
    <view class="related-images-section" wx:if="{{activity.relatedImages && activity.relatedImages.length > 0}}">
      <view class="section-title">ç›¸å…³å›¾ç‰‡</view>
      <view class="related-images-grid">
        <block wx:for="{{activity.relatedImages}}" wx:key="*this">
          <image class="related-image" src="{{item}}" mode="aspectFill" bindtap="previewImage" data-index="{{index}}" />
        </block>
      </view>
    </view>

    <!-- å‚ä¸è€…åˆ—è¡¨ï¼ˆæ´»åŠ¨è¿›è¡Œä¸­æˆ–å·²ç»“æŸæ—¶æ˜¾ç¤ºï¼‰ -->
    <view class="participants-section" wx:if="{{status > 0 && activity.participants && activity.participants.length > 0}}">
      <view class="section-title">å‚ä¸è€…</view>
      <view class="participants-grid">
        <block wx:for="{{activity.participants}}" wx:key="id">
          <view class="participant-item">
            <image class="participant-avatar" src="{{item.avatar}}" />
            <view class="participant-name">{{item.nickname}}</view>
            <view class="participant-badge" wx:if="{{item.id === activity.creator.id}}">å‘èµ·è€…</view>
          </view>
        </block>
      </view>
    </view>

    <view class="host-card">
      <image class="avatar" src="{{activity.creator.avatar}}" />
      <view class="host-info">
        <view class="name">{{activity.creator.nickname}}</view>
        <view class="role">æ´»åŠ¨å‘èµ·è€…</view>
        <view wx:if="{{activity.contact}}" class="contact-info">
          <view class="contact-label">è”ç³»äººï¼š</view>
          <view class="contact-value">{{activity.contact}}</view>
        </view>
        <view wx:if="{{activity.contactInfo}}" class="contact-info" catchtap="contact">
          <view class="contact-label">è”ç³»æ–¹å¼ï¼š</view>
          <view class="contact-value">{{activity.contactInfo}}</view>
        </view>
      </view>
      <button class="contact-btn" size="mini" catchtap="contact">è”ç³»</button>
    </view>
  </view>

  <view class="bottom-bar">
    <button class="share-btn" open-type="share">
      <text style="font-size:32rpx;">ğŸ“¤</text>
      <text>åˆ†äº«</text>
    </button>
    
    <block wx:if="{{status === 0}}">
      <button wx:if="{{isCreator}}" class="join-btn creator-btn" catchtap="startActivity">å¼€å§‹æ´»åŠ¨</button>
      <button wx:elif="{{!isJoined}}" class="join-btn" catchtap="join">ç«‹å³æŠ¥å</button>
      <button wx:else class="join-btn disabled" disabled>å·²æŠ¥åï¼Œç­‰å¾…å¼€å§‹</button>
    </block>

    <block wx:if="{{status === 1}}">
      <button wx:if="{{isCreator}}" class="join-btn finish-style" catchtap="finishActivity">ç¡®è®¤ç»“æŸæ´»åŠ¨</button>
      <button wx:else class="join-btn disabled" disabled>æ´»åŠ¨è¿›è¡Œä¸­...</button>
    </block>

    <block wx:if="{{status === 2}}">
      <button class="join-btn settle-style" catchtap="goToSettle">
        {{isCreator ? 'ç®¡ç†æ´»åŠ¨ç»“ç®—' : 'æŸ¥çœ‹æ´»åŠ¨ç»“ç®—'}}
      </button>
    </block>
  </view>
</view>