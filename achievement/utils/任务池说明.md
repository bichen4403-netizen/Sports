# 统一任务池说明

## 数据结构

`app.globalData.taskPools` 为统一任务容器，按 `chatId` 分组，每对用户有四个池子：

| 池子 | 说明 | 是否显示在日历 | 是否写入历史 |
|------|------|----------------|--------------|
| pending | 一方发给另一方，待对方接受/拒绝 | 否 | 否 |
| accepted | 已接受，进行中 | 是 | 是（进行中） |
| completed | 已打勾完成（含时长、评价） | 是 | 是（完成） |
| rejected | 已拒绝 | 否 | 是（拒绝） |

## 流程

1. **发起任务**：`createInvite` → 加入 `pending`（fromMe=true 表示我发给对方）
2. **接受**：`acceptInvite` → 从 `pending` 移到 `accepted`
3. **拒绝**：`rejectInvite` → 从 `pending` 移到 `rejected`
4. **打勾完成**：`markTaskCompleted` → 从 `accepted` 移到 `completed`，需填写时长、评价

## 涉及页面

- **首页日历**：`getCalendarTasks()` 汇总所有 chatId 的 accepted + completed
- **擂台页**：`getPendingForMe()` 取当前 chatId 的 pending；`getCurrentTask()` 取进行中任务
- **历史任务页**：`getHistoryTasks()` 取 accepted + completed + rejected，标注进行中/完成/拒绝

## 成就值计算

`completed` 池子中的任务参与后续成就值计算。
