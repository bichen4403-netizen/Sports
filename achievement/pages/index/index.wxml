<view class="index-container">
  <!-- é¡¶éƒ¨ï¼šæˆå°±å•†åº—å…¥å£ -->
  <view class="mall-entry" bindtap="goMall">
    <view class="mall-entry-inner">
      <view class="mall-icon-wrap">
        <text class="mall-icon">ğŸª</text>
      </view>
      <view class="mall-text">
        <text class="mall-title">æˆå°±å•†åº—</text>
        <text class="mall-desc">å…‘æ¢è£…å¤‡ä¸å¥–åŠ±</text>
      </view>
      <text class="mall-arrow">â€º</text>
    </view>
  </view>

  <!-- åˆ†éš”æ ‡é¢˜ -->
  <view class="section-header">
    <text class="section-title">åŒ¹é…ä¼™ä¼´</text>
  </view>

  <!-- æ—¥å†ï¼šæœˆè§†å›¾ï¼ŒæˆåŠŸçº¦å®šé»„ç‚¹ï¼Œä¸æ­å­ç±»å‹ç­›é€‰è”åŠ¨ -->
  <view class="calendar-wrap">
    <view class="calendar-header">
      <view class="calendar-nav" bindtap="prevMonth">
        <text class="calendar-arrow">â€¹</text>
      </view>
      <text class="calendar-title">{{calendarTitle}}</text>
      <view class="calendar-nav" bindtap="nextMonth">
        <text class="calendar-arrow">â€º</text>
      </view>
    </view>
    <view class="calendar-week-row">
      <text class="calendar-week-cell" wx:for="{{weekHeaders}}" wx:key="*this">{{item}}</text>
    </view>
    <view class="calendar-grid">
      <view
        class="calendar-cell {{item.isCurrentMonth ? 'current-month' : 'other-month'}} {{item.isToday ? 'today' : ''}} {{item.hasDot ? 'has-dot-tappable' : ''}}"
        wx:for="{{calendarDays}}"
        wx:key="index"
        data-date-key="{{item.dateKey}}"
        data-has-dot="{{item.hasDot}}"
        bindtap="onCalendarDayTap"
      >
        <view class="calendar-day-wrap" wx:if="{{item.day > 0}}">
          <text class="calendar-day-num">{{item.day}}</text>
        </view>
        <view class="calendar-dot" wx:if="{{item.hasDot}}"></view>
      </view>
    </view>
  </view>

  <!-- æ’åºä¸ç­›é€‰ï¼šæ­å­ç±»å‹ + æ´»è·ƒç¨‹åº¦ï¼ˆç¬¦åˆå°ç¨‹åºè§„èŒƒï¼Œåˆ—è¡¨ä¸Šæ–¹å›ºå®šç­›é€‰æ ï¼‰ -->
  <view class="filter-bar">
    <view class="filter-item">
      <text class="filter-label">æ­å­ç±»å‹</text>
      <picker mode="selector" range="{{sportTypeOptions}}" value="{{sportTypeIndex}}" bindchange="onSportTypeChange">
        <view class="filter-value">
          <text>{{sportTypeOptions[sportTypeIndex]}}</text>
          <text class="filter-arrow">â€º</text>
        </view>
      </picker>
    </view>
    <view class="filter-item">
      <text class="filter-label">æ´»è·ƒç¨‹åº¦</text>
      <picker mode="selector" range="{{activitySortOptions}}" value="{{activitySortIndex}}" bindchange="onActivitySortChange">
        <view class="filter-value">
          <text>{{activitySortOptions[activitySortIndex]}}</text>
          <text class="filter-arrow">â€º</text>
        </view>
      </picker>
    </view>
  </view>

  <!-- èŠå¤©åˆ—è¡¨ï¼šå±•ç¤ºç»ç­›é€‰ã€æ’åºåçš„åˆ—è¡¨ -->
  <scroll-view class="chat-list" scroll-y="{{true}}" enhanced="{{true}}">
    <view
      class="chat-item"
      wx:for="{{displayList}}"
      wx:key="id"
      data-id="{{item.id}}"
      bindtap="openChat"
    >
      <block wx:if="{{item.avatar === defaultAvatarUrl}}">
        <view class="item-avatar item-avatar-placeholder">
          <text class="item-avatar-icon">ğŸ‘¤</text>
        </view>
      </block>
      <image wx:else class="item-avatar" src="{{item.avatar}}" mode="aspectFill" />
      <view class="item-body">
        <view class="item-name-row">
          <text class="item-name">{{item.nickName}}</text>
          <text class="item-sport-tag" wx:if="{{item.sportType}}">{{item.sportType}}</text>
        </view>
        <text class="item-last-msg">{{item.lastMessage}}</text>
      </view>
      <view class="item-right">
        <text class="item-time">{{item.lastTime}}</text>
        <!-- ç«èŠ±ï¼šä¸æ´»è·ƒç¨‹åº¦æ˜ å°„ï¼Œæ´»è·ƒä¸€å¤©ä¸€é¡¹æ´»åŠ¨+1ï¼ˆå±•ç¤º activityScoreï¼Œæ— åˆ™ç”¨ sparkCountï¼‰ -->
        <view class="item-spark">
          <text class="spark-icon">ğŸ”¥</text>
          <text class="spark-num">{{item.activityScore != null ? item.activityScore : (item.sparkCount || 0)}}</text>
        </view>
      </view>
    </view>
    <view class="empty-tip" wx:if="{{displayList.length === 0}}">
      <text>{{filterEmptyTip}}</text>
    </view>
  </scroll-view>

  <!-- æ—¥å†é»„ç‚¹è¯¦æƒ…å¼¹çª—ï¼šå½“æ—¥çº¦å®šã€è¿åŠ¨ç±»å‹ã€ä¼™ä¼´ã€æ—¶é—´ -->
  <view class="task-detail-mask" wx:if="{{showTaskDetailModal}}" catchtap="closeTaskDetailModal">
    <view class="task-detail-modal" catchtap="preventTapPropagation">
      <view class="task-detail-header">
        <text class="task-detail-title">{{taskDetailDate}}</text>
        <view class="task-detail-close" bindtap="closeTaskDetailModal">Ã—</view>
      </view>
      <view class="task-detail-list">
        <view class="task-detail-item" wx:for="{{taskDetailList}}" wx:key="taskId">
          <view class="task-detail-main">
            <text class="task-detail-sport">{{item.sportType}}</text>
            <text class="task-detail-partner">ä¸ {{item.partnerName || 'ä¼™ä¼´'}}</text>
            <text class="task-detail-time">{{item.taskTime || 'â€”'}}</text>
            <text class="task-detail-status" wx:if="{{item.status === 'completed'}}">âœ“ å·²å®Œæˆ</text>
          </view>
          <button
            wx:if="{{item._status === 'accepted'}}"
            class="task-detail-complete-btn"
            data-task-id="{{item.taskId}}"
            data-chat-id="{{item.chatId}}"
            bindtap="openCompleteForm"
          >å®Œæˆ</button>
        </view>
      </view>
    </view>
  </view>

  <!-- æ‰“å‹¾å®Œæˆè¡¨å•ï¼šå¡«å†™æ—¶é•¿ã€è¯„ä»· -->
  <view class="task-detail-mask" wx:if="{{showCompleteForm}}" catchtap="closeCompleteForm">
    <view class="task-detail-modal" catchtap="preventTapPropagation">
      <view class="task-detail-header">
        <text class="task-detail-title">æ ‡è®°å®Œæˆ</text>
        <view class="task-detail-close" bindtap="closeCompleteForm">Ã—</view>
      </view>
      <view class="complete-form">
        <view class="complete-form-row">
          <text class="complete-form-label">è¿åŠ¨æ—¶é•¿</text>
          <input class="complete-form-input" placeholder="å¦‚ 30åˆ†é’Ÿ" value="{{completeDuration}}" bindinput="onCompleteDurationInput" />
        </view>
        <view class="complete-form-row">
          <text class="complete-form-label">è¯„ä»·</text>
          <picker mode="selector" range="{{completeRatingOptions}}" value="{{completeRatingIndex}}" bindchange="onCompleteRatingChange">
            <view class="complete-form-picker">{{completeRatingOptions[completeRatingIndex]}}</view>
          </picker>
        </view>
        <button class="complete-form-btn" bindtap="submitComplete">ç¡®è®¤å®Œæˆ</button>
      </view>
    </view>
  </view>
</view>
