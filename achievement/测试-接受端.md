# 接受端（接受/拒绝活动）测试说明

## 一、在微信开发者工具里怎么测

### 1. 打开项目并确认 Mock 开启

- 用微信开发者工具打开本项目，确保 **app.js** 里 `globalData.useMock === true`（默认已是）。
- 编译后进入首页（匹配伙伴列表）。

### 2. 进入擂台页（接受端界面）

- 在首页点击任意一个伙伴（例如 **「跑步小能手」** 或 **「步数达人」**），进入该伙伴的擂台页。
- 在「共同成就值」下方、「当前任务」上方，应出现一块 **「对方发起的任务」**，里面是 mock 的 1～2 条待处理邀请。

### 3. 测试「接受」

- 在「对方发起的任务」里任选一条，点击 **「接受」**。
- **预期**：该条从列表中消失，并弹出 Toast「已接受」。
- 可多进几次擂台页，对剩余邀请继续点「接受」，直到列表为空。

### 4. 测试「拒绝」+ 选择理由

- 若还有待处理邀请，点 **「拒绝」**。
- **预期**：底部弹出「拒绝理由」弹层。
- 选择预设理由之一（**时间冲突 / 已有安排 / 不方便 / 其他**），再点 **「确认拒绝」**。
- **预期**：该条从列表消失，弹层关闭，Toast「已拒绝」。

### 5. 测试「拒绝」+ 自定义说明

- 再进一个还有待处理邀请的伙伴（例如 **「步数达人」** 若还有一条），点 **「拒绝」**。
- 在拒绝理由里选 **「其他」**，在下方输入框输入一段说明（如「本周有事」），再点 **「确认拒绝」**。
- **预期**：同样该条消失、Toast「已拒绝」。  
- 也可选非「其他」的理由，在「可补充说明」里随便输入几个字，再确认拒绝，验证补充说明不会报错。

### 6. 不同伙伴的 mock 数据

- **跑步小能手**（chatId=1）：mock 里有 2 条待处理邀请。
- **步数达人**（chatId=2）：mock 里有 1 条待处理邀请。
- **晨练伙伴**（chatId=3）：mock 未塞数据，进入后「对方发起的任务」不显示或为空，属正常。

可按上面步骤在不同伙伴间切换，反复测接受、拒绝（仅理由、仅说明、理由+说明）。

---

## 二、如何「重新测一轮」待处理邀请

Mock 的待处理邀请在 app 启动时由 **utils/task-pools.js** 的 `initMockTaskPools` 写入 `globalData.taskPools[chatId].pending`；接受后移到 `accepted`，拒绝后移到 `rejected`。

若要再测一轮：

1. **重新编译**：在微信开发者工具顶部菜单点 **「编译」** 或快捷键重新编译，会重新执行 `App.onLaunch`，`initMockTaskPools` 会重新初始化各 chatId 的 pending/accepted/completed/rejected。

---

## 三、接口接好后怎么测

- 将 **app.js** 里 `globalData.useMock` 改为 **false**，并在各请求处填好 **API_BASE**。
- 由后端提供：待处理邀请列表、接受、拒绝（含 reasonType/reasonText）接口。
- 在真机或开发者工具中：用账号 A 发起任务，用账号 B 登录同一小程序，在对应伙伴的擂台页应看到「对方发起的任务」，再按上面步骤测接受/拒绝与理由、说明是否生效。
